---
export const prerender = true;

import "@/styles/codeblock.css";
import "@/styles/blog.css";
import { type CollectionEntry } from "astro:content";
import { render } from "astro:content";
import Layout from "@layouts/layout.astro";
import BlogHero from "@components/blog/blog-hero.astro";
import SEO from "@components/seo.astro";
import { getPosts } from "@/utils/get-posts";

export async function getStaticPaths() {
  const posts = await getPosts();

  return posts.map((post) => ({
    params: { slug: post.id },
    props: post
  }));
}

type Props = CollectionEntry<"blog">;
const post = Astro.props;
const { Content } = await render(post);
---

<Layout>
  <SEO
    slot="head"
    description={post.data.description}
    title={post.data.title}
    keywords={post.data.keywords}
    pubDate={(post.data.updatedDate || post.data.pubDate).toISOString()}
    ogImage={`/blog/${post.id}/og.png`}
    category={post.data.tags?.[0]}
    tags={post.data.tags}
  />

  <article class="flex flex-col gap-4">
    <BlogHero text={post.data.title} />
    <div
      class="animate-fade-in-up mx-auto max-w-full min-w-[40ch] pb-14 text-base leading-7 text-pretty md:max-w-[85ch] md:text-lg"
      data-blog-content>
      <Content />
    </div>
  </article>
</Layout>
