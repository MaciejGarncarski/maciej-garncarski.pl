---

---

<button
  data-theme-switcher
  aria-label="Przełącz motyw"
  title="Przełącz motyw"
  class="border-border bg-background-secondary hover:bg-background-secondary/80 relative flex h-10 w-10 cursor-pointer items-center justify-center rounded-full border transition-all duration-200 hover:scale-105 active:scale-95"
>
  <span class="sr-only">Przełącz motyw</span>

  <!-- Sun icon (visible in dark mode — click to switch to light) -->
  <svg
    data-icon="sun"
    xmlns="http://www.w3.org/2000/svg"
    width="19"
    height="19"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="absolute opacity-0 transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)]"
    ><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"
    ></line><line x1="12" y1="21" x2="12" y2="23"></line><line
      x1="4.22"
      y1="4.22"
      x2="5.64"
      y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"
    ></line><line x1="1" y1="12" x2="3" y2="12"></line><line
      x1="21"
      y1="12"
      x2="23"
      y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"
    ></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg
  >

  <!-- Moon icon (visible in light mode — click to switch to dark) -->
  <svg
    data-icon="moon"
    xmlns="http://www.w3.org/2000/svg"
    width="19"
    height="19"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="absolute opacity-0 transition-all duration-500 ease-[cubic-bezier(0.34,1.36,0.64,1)]"
    ><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg
  >
</button>

<script>
  import type { TransitionBeforeSwapEvent } from "astro:transitions/client";

  type Theme = "light" | "dark";

  function initThemeSwitcher() {
    const button = document.querySelector("[data-theme-switcher]");
    if (!button) return;

    const icons = {
      sun: button.querySelector('[data-icon="sun"]'),
      moon: button.querySelector('[data-icon="moon"]'),
    };

    button.classList.remove("transition-all", "duration-200");
    icons.sun?.classList.remove("transition-all", "duration-500");
    icons.moon?.classList.remove("transition-all", "duration-500");

    setTimeout(() => {
      button.classList.add("transition-all", "duration-200");
      icons.sun?.classList.add("transition-all", "duration-500");
      icons.moon?.classList.add("transition-all", "duration-500");
    }, 200);

    function getEffectiveTheme(): Theme {
      const stored = localStorage.getItem("theme");
      if (stored === "light" || stored === "dark") return stored;
      return window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
    }

    function updateIcon(theme: Theme) {
      // Sun exits rotating clockwise, moon exits rotating counter-clockwise
      icons.sun?.classList.add("opacity-0", "scale-0", "rotate-90");
      icons.sun?.classList.remove("opacity-100", "scale-100", "rotate-0");

      icons.moon?.classList.add("opacity-0", "scale-0", "-rotate-90");
      icons.moon?.classList.remove("opacity-100", "scale-100", "rotate-0");

      const activeIcon = theme === "dark" ? icons.sun : icons.moon;

      activeIcon?.classList.remove(
        "opacity-0",
        "scale-0",
        "rotate-90",
        "-rotate-90",
      );
      activeIcon?.classList.add("opacity-100", "scale-100", "rotate-0");
    }

    function setTheme(theme: Theme) {
      document.documentElement.className = theme;
      localStorage.setItem("theme", theme);
      updateIcon(theme);
    }

    function toggleTheme() {
      const current = getEffectiveTheme();
      setTheme(current === "light" ? "dark" : "light");
    }

    updateIcon(getEffectiveTheme());

    button.addEventListener("click", toggleTheme);
  }

  document.addEventListener(
    "astro:before-swap",
    (swapEvent: TransitionBeforeSwapEvent) => {
      const stored = localStorage.getItem("theme");
      const theme =
        stored === "light" || stored === "dark"
          ? stored
          : window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light";

      swapEvent.newDocument.documentElement.className = theme;
    },
  );

  document.addEventListener("astro:after-swap", initThemeSwitcher);

  initThemeSwitcher();
</script>
